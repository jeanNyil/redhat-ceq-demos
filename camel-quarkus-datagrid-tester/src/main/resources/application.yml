# Configuration file

# Red Hat Data Grid caches
datagrid:
  caches:
    fruits-legumes: fruits-legumes-replicated-cache
    idempotency: idempotency-replicated-cache

# MinIO
minio:
  endpoint: http://localhost:9000
  access-key: minioadmin
  secret-key: d-XT,YJ.XF3c_WT[
  bucket-name: ${camel.context.name}
  delete-after-read: false # I deactivated the delete after object retrieval for the Idempotent Consumer EIP using RHDG demo purposes. Default is usually `true`.
  next-poll-delay-in-ms: 30000 # Milliseconds before the next poll. I set it to 30000ms for demo purposes. Default is usually `500`.

# Camel
camel:
  context:
    name: camel-quarkus-datagrid-tester

# MicroProfile OpenAPI configuration
# Reference: https://quarkus.io/guides/openapi-swaggerui
## Serve only static OpenAPI document
mp:
  openapi:
    scan:
      disable: true

# Quarkus
quarkus:

  # Red Hat Data Grid (Infinispan)
  infinispan-client:
    # Sets the host name/port to connect to. Each one is separated by a semicolon
    hosts: datagrid.apps.ocp4.jnyilimb.eu:443
    # Server name used by authentication
    auth-server-name: datagrid-cluster
    # Realm used by authentication
    auth-realm: default
    # Authentication
    username: cameluser
    password: P@ssw0rd
    client-intelligence: BASIC
    sasl-mechanism: PLAIN
    sni-host-name: datagrid.apps.ocp4.jnyilimb.eu
    trust-store: ./tls-keys/truststore.p12
    trust-store-password: P@ssw0rd
  
  # CORS configuration
  http:
    cors:
      enabled: true
      origins: "*" # Allows all origins for demo purposes
  # Swagger UI configuration
  # Reference: https://quarkus.io/guides/openapi-swaggerui
  ## Always include the Swagger UI in the generated OpenAPI specification
  swagger-ui:
    always-include: true

  # Enable native SSL support
  ssl:
    native: true

  ## Quarkus OpenShift extension configuration
  # Eventually, the client should trust a self signed certificate presented by the API server
  kubernetes-client:
    trust-certs: true

  openshift:
    annotations:
      # OpenShift web console visual connection to the ftp-server
      app.openshift.io/connects-to: >-
        [{"apiVersion":"apps/v1","kind":"Deployment","name":"minio"}]
    # The kind of the deployment resource to use. Supported values are 'Deployment', 'StatefulSet', 'Job', 'CronJob' and 'DeploymentConfig' defaulting to the latter.
    deployment-kind: Deployment
    # Part of the `RHAF-CEQ-Demo` Application Group
    part-of: RHAF-CEQ-Demo
    labels:
      app.openshift.io/runtime: camel # Apache Camel icon
      camel.apache.org/app: ${camel.context.name} # For Camel Dashboard on OpenShift discoverability
    # The build config strategy to use
    build-strategy: DOCKER
    # The number of desired pods
    replicas: 2
    # Expose OpenShift route
    route:
      expose: true
      tls:
        termination: edge
    # The type of service that will be generated for the application
    service-type: ClusterIP
    # CPU and Memory resources requirements when deployed on Kubernetes/OpenShift
    resources:
      requests:
        cpu: 30m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 512Mi
    # Generation of ServiceMonitor resource
    ## By default, a ServiceMonitor resource is generated.
    ## Disabled means no ServiceMonitor resource is generated   
    prometheus:
      generate-service-monitor: false
    # Secret to mount and where to mount it
    secret-volumes:
      truststore-volume:
        secret-name: camel-quarkus-datagrid-tester-truststore-secret
    mounts:
      truststore-volume:
        path: /mnt/ssl

  # OpenTelemetry configuration. This is leveraged by Camel Quarkus OpenTelemetry extension
  ## Identifier for the origin of spans created by the application
  application:
    name: ${camel.context.name}
  otel:
    sdk:
      disabled: false
    logs:
      enabled: true

  log:
    console:
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p traceId=%X{traceId}, parentId=%X{parentId}, spanId=%X{spanId}, sampled=%X{sampled} [%c{2.}] (%t) %s%e%n"

  # Management endpoints on a separate interface
  ## By default, management endpoints are exposed on the management port (9876)
  ## Disabled means expose those endpoints in the regular service port (default, 8080)
  management:
    enabled: true
  
  ## Camel Quarkus
  camel:
    jolokia:
      kubernetes:
        client-principal: cn=hawtio-online.hawtio.svc
    metrics:
      enable-message-history: true

    # native mode configuration
    native:
      # A comma separated list of Ant-path style patterns to match class names
      # that should be registered for reflection.
      # Reference: https://camel.apache.org/camel-quarkus/latest/user-guide/native-mode.html#reflection
      reflection:
        include-patterns: java.lang.Exception

  ## Quarkus native build 
  native:
    # If all character sets should be added to the native image. This increases image size
    add-all-charsets: true
    # If this build should be done using a container runtime. 
    # If this is set docker will be used by default, unless container-runtime is also set.
    container-build: true
    # A comma separated list of Ant-path style patterns to match resources
    # that should be <strong>included</strong> in the native executable. By default,
    # resources not selected by quarkus itself are ignored. Then, inclusion
    # of additional resources could be triggered with
    # <code>includePatterns</code>. When the inclusion patterns is too
    # large, eviction of previously selected resources could be triggered
    # with <code>excludePatterns</code>.
    resources:
      includes: META-INF/*,minio-test-files/*,tls-keys/*

# Only when running in prod profile
"%prod":
  quarkus:
    # Quarkus kubernetes config extension
    kubernetes-config:
      # Enable to look up the configuration from the API server
      enabled: true
      # ConfigMaps (list of strings) to look for in the namespace that the Kubernetes Client has been configured for
      config-maps: ${camel.context.name}-config
      secrets:
        # Secrets (list of strings) to look for in the namespace that the Kubernetes Client has been configured for 
        ~: ${camel.context.name}-secret
        # Enable to generate the necessary role and corresponding role binding
        enabled: true